<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ADMIN PANEL</title>

<style>
body{
  background:#111;
  color:white;
  font-family:monospace;
  padding:20px;
  text-align:center;
}

h2{ color:cyan; }

input{
  padding:6px;
  margin:5px;
  border-radius:6px;
  border:none;
  text-align:center;
}

button{
  padding:6px 10px;
  margin:5px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}

.createBtn{ background:lime; }
.loadBtn{ background:cyan; }
.deleteBtn{ background:red; color:white; }

table{
  margin:auto;
  margin-top:20px;
  border-collapse:collapse;
  width:95%;
}

th,td{
  border:1px solid white;
  padding:6px;
  font-size:12px;
  word-break:break-all;
}

th{ background:#222; }
</style>
</head>
<body>

<h2>üî• ADMIN PANEL üî•</h2>

<h3>T·∫†O KEY M·ªöI</h3>

<input type="number" id="hours" placeholder="S·ªë gi·ªù (vd: 24)">
<input type="number" id="devices" placeholder="S·ªë thi·∫øt b·ªã (vd: 1)">
<br>
<button class="createBtn" onclick="createKey()">T·∫†O KEY</button>

<hr>

<button class="loadBtn" onclick="loadKeys()">T·∫¢I DANH S√ÅCH KEY</button>

<div>
  T·ªïng s·ªë key: <span id="total">0</span>
</div>

<table>
<thead>
<tr>
<th>Key</th>
<th>Thi·∫øt b·ªã</th>
<th>H·∫øt h·∫°n</th>
<th>X√≥a</th>
</tr>
</thead>
<tbody id="keyList"></tbody>
</table>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCBoDV8N9q56YjrNlKoiQk6c6fYDNJL2pw",
  authDomain: "kephandienkey-fbee7.firebaseapp.com",
  projectId: "kephandienkey-fbee7",
  storageBucket: "kephandienkey-fbee7.firebasestorage.app",
  messagingSenderId: "1004820527441",
  appId: "1:1004820527441:web:a2ffa3aefb82b99a97fb70"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// T·∫†O KEY
window.createKey = async function(){

  const hours = parseInt(document.getElementById("hours").value);
  const devices = parseInt(document.getElementById("devices").value);

  if(!hours || !devices){
    alert("Nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
    return;
  }

  const key = "KPD_" + Math.random().toString(36).substring(2,10).toUpperCase();
  const expire = Date.now() + hours * 60 * 60 * 1000;

  await addDoc(collection(db,"adminKeys"),{
    key:key,
    maxDevices:devices,
    expire:expire,
    created:Date.now()
  });

  alert("T·∫°o key th√†nh c√¥ng:\n" + key);

  loadKeys();
}

// LOAD KEY
window.loadKeys = async function(){

  const querySnapshot = await getDocs(collection(db,"adminKeys"));
  const list = document.getElementById("keyList");
  list.innerHTML="";
  let count=0;

  querySnapshot.forEach((docSnap)=>{
    count++;

    const data = docSnap.data();

    list.innerHTML += `
      <tr>
        <td>${data.key}</td>
        <td>${data.maxDevices}</td>
        <td>${new Date(data.expire).toLocaleString()}</td>
        <td>
          <button class="deleteBtn" onclick="deleteKey('${docSnap.id}')">
            X√ìA
          </button>
        </td>
      </tr>
    `;
  });

  document.getElementById("total").innerText=count;
}

// X√ìA KEY
window.deleteKey = async function(id){
  if(confirm("X√≥a key n√†y?")){
    await deleteDoc(doc(db,"adminKeys",id));
    loadKeys();
  }
}

</script>

</body>
</html>
