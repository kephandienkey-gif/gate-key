<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
body{margin:0;font-family:Arial;background:#0f172a;color:white}
.container{max-width:500px;margin:auto;padding:20px}
.card{background:#1e293b;padding:20px;border-radius:12px;margin-bottom:20px}
input{width:100%;padding:10px;margin:5px 0;border-radius:8px;border:none;background:#334155;color:white}
button{padding:8px 12px;border:none;border-radius:8px;cursor:pointer;margin-top:5px}
.btn-main{background:#3b82f6;color:white}
.key-item{background:#334155;padding:10px;border-radius:10px;margin-bottom:10px}
</style>
</head>

<body>
<div class="container">
<h2>üîê Admin Panel</h2>

<div class="card">
<h3>T·∫°o Key</h3>
<input type="text" id="customKey" placeholder="Nh·∫≠p key (b·ªè tr·ªëng = random)">
<input type="number" id="time" placeholder="Th·ªùi gian (gi·ªù)">
<input type="number" id="device" placeholder="Gi·ªõi h·∫°n thi·∫øt b·ªã">
<button class="btn-main" onclick="createKey()">T·∫°o Key</button>
</div>

<div class="card">
<h3>Danh s√°ch Key</h3>
<div id="keyList"></div>
</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCBoDV8N9q56YjrNlKoiQk6c6fYDNJL2pw",
  authDomain: "kephandienkey-fbee7.firebaseapp.com",
  projectId: "kephandienkey-fbee7",
  storageBucket: "kephandienkey-fbee7.firebasestorage.app",
  messagingSenderId: "1004820527441",
  appId: "1:1004820527441:web:a2ffa3aefb82b99a97fb70"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const keyList = document.getElementById("keyList");

function randomKey(){
    return Math.random().toString(36).substring(2,10).toUpperCase();
}

window.createKey = async function(){
    const customKey = document.getElementById("customKey").value;
    const time = document.getElementById("time").value;
    const device = document.getElementById("device").value;

    const finalKey = customKey ? customKey : randomKey();

    await addDoc(collection(db,"keys"),{
        key: finalKey,
        time: Number(time),
        device: Number(device),
        createdAt: Date.now()
    });

    alert("T·∫°o key th√†nh c√¥ng!");
    loadKeys();
}

async function loadKeys(){
    keyList.innerHTML="";
    const snapshot = await getDocs(collection(db,"keys"));

    snapshot.forEach((docItem)=>{
        const data = docItem.data();
        const div = document.createElement("div");
        div.className="key-item";

        div.innerHTML=`
        <b>${data.key}</b><br>
        ${data.time} gi·ªù | ${data.device} thi·∫øt b·ªã
        <button onclick="deleteKey('${docItem.id}')">Xo√°</button>
        `;

        keyList.appendChild(div);
    });
}

window.deleteKey = async function(id){
    await deleteDoc(doc(db,"keys",id));
    alert("ƒê√£ xo√° key");
    loadKeys();
}

loadKeys();

</script>
</body>
</html>
