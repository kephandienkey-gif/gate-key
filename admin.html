<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADMIN PANEL</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#0f0f0f,#1a1a1a);
  color:white;
  text-align:center;
}

h2{
  font-size:32px;
  margin-top:20px;
}

.box{
  background:#1e1e1e;
  padding:25px;
  margin:20px auto;
  width:450px;
  border-radius:20px;
  box-shadow:0 0 25px #000;
}

.stats{
  font-size:18px;
  margin-bottom:15px;
  color:#00e5ff;
}

input,button{
  width:95%;
  padding:10px;
  margin:6px;
  border-radius:10px;
  border:none;
  font-size:14px;
}

button{
  cursor:pointer;
  font-weight:bold;
  transition:0.2s;
}

button:hover{
  transform:scale(1.05);
}

.create{background:#00c853;color:white;}
.random{background:#2979ff;color:white;}
.delete{background:#d50000;color:white;}
.edit{background:#ff9100;color:black;}
.extend{background:#00b0ff;color:white;}
.logout{background:orange;color:black;}

.keyItem{
  background:#2c2c2c;
  margin:10px;
  padding:15px;
  border-radius:15px;
  font-size:14px;
}
</style>
</head>
<body>

<h2>üîê ADMIN CONTROL PANEL</h2>

<div class="box" id="loginBox">
  <h3>ƒêƒÉng nh·∫≠p Admin</h3>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div class="box" id="adminBox" style="display:none;">

  <div class="stats">
    üì¶ T·ªïng key: <span id="totalKeys">0</span><br>
    üî• T·ªïng l∆∞·ª£t get: <span id="totalGet">0</span>
  </div>

  <h3>T·∫°o Key</h3>
  <input type="text" id="newKey" placeholder="Nh·∫≠p key (ƒë·ªÉ tr·ªëng = random)">
  <input type="number" id="expireHours" placeholder="H·∫øt h·∫°n sau (gi·ªù)">
  <button class="create" onclick="createKey()">T·∫†O KEY</button>
  <button class="random" onclick="createRandom()">T·∫†O RANDOM</button>

  <h3>Danh s√°ch key</h3>
  <div id="keyList"></div>

  <button class="logout" onclick="logout()">ƒêƒÉng xu·∫•t</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = { 
  apiKey : "AIzaSyCBoDV8N9q56YjrNlKoiQk6c6fYDNJL2pw" , 
  authDomain : "kephandienkey-fbee7.firebaseapp.com" , 
  projectId : "kephandienkey-fbee7" , 
  storageBucket : "kephandienkey-fbee7.firebasestorage.app" , 
  messagingSenderId : "1004820527441" , 
  appId : "1:1004820527441:web:a2ffa3aefb82b99a97fb70" 
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const loginBox = document.getElementById("loginBox");
const adminBox = document.getElementById("adminBox");
const keyList = document.getElementById("keyList");

const totalKeysEl = document.getElementById("totalKeys");
const totalGetEl = document.getElementById("totalGet");

window.login = async function(){
  try{
    await signInWithEmailAndPassword(auth,email.value,password.value);
    alert("ƒêƒÉng nh·∫≠p th√†nh c√¥ng!");
  }catch{
    alert("Sai t√†i kho·∫£n!");
  }
};

onAuthStateChanged(auth,(user)=>{
  if(user){
    loginBox.style.display="none";
    adminBox.style.display="block";
    loadKeys();
  }else{
    loginBox.style.display="block";
    adminBox.style.display="none";
  }
});

function randomKey(){
  return "KEY-" + Math.random().toString(36).substring(2,8).toUpperCase();
}

window.createRandom = function(){
  newKey.value = randomKey();
};

window.createKey = async function(){
  let key = newKey.value;
  const hours = expireHours.value;

  if(!hours){
    alert("Nh·∫≠p gi·ªù h·∫øt h·∫°n!");
    return;
  }

  if(!key) key = randomKey();

  const expireTime = Date.now() + hours * 60 * 60 * 1000;

  await addDoc(collection(db,"keys"),{
    key:key,
    expire:expireTime,
    get:0
  });

  alert("T·∫°o key th√†nh c√¥ng!");
  loadKeys();
};

async function loadKeys(){
  keyList.innerHTML="";
  let totalKeys=0;
  let totalGet=0;

  const snapshot = await getDocs(collection(db,"keys"));

  snapshot.forEach(docSnap=>{
    const data = docSnap.data();

    if(Date.now() > data.expire){
      deleteDoc(doc(db,"keys",docSnap.id));
      return;
    }

    totalKeys++;
    totalGet += data.get || 0;

    const div = document.createElement("div");
    div.className="keyItem";
    div.innerHTML=`
      üîë ${data.key}<br>
      ‚è≥ ${new Date(data.expire).toLocaleString()}<br>
      üî• L∆∞·ª£t get: ${data.get || 0}<br>
      <button onclick="extendKey('${docSnap.id}')" class="extend">+ Gi·ªù</button>
      <button onclick="editKey('${docSnap.id}')" class="edit">ƒê·∫∑t l·∫°i th·ªùi gian</button>
      <button onclick="deleteKey('${docSnap.id}')" class="delete">XO√Å</button>
    `;
    keyList.appendChild(div);
  });

  totalKeysEl.textContent = totalKeys;
  totalGetEl.textContent = totalGet;
}

window.extendKey = async function(id){
  const hours = prompt("Gia h·∫°n th√™m bao nhi√™u gi·ªù?");
  if(!hours) return;

  const docRef = doc(db,"keys",id);
  const snapshot = await getDocs(collection(db,"keys"));
};

window.editKey = async function(id){
  const hours = prompt("ƒê·∫∑t l·∫°i th·ªùi gian (gi·ªù t·ª´ b√¢y gi·ªù)?");
  if(!hours) return;

  const newExpire = Date.now() + hours * 60 * 60 * 1000;
  await updateDoc(doc(db,"keys",id),{
    expire:newExpire
  });

  loadKeys();
};

window.extendKey = async function(id){
  const hours = prompt("Gia h·∫°n th√™m bao nhi√™u gi·ªù?");
  if(!hours) return;

  const docRef = doc(db,"keys",id);
  const snapshot = await getDocs(collection(db,"keys"));

  snapshot.forEach(async d=>{
    if(d.id === id){
      const newExpire = d.data().expire + hours * 60 * 60 * 1000;
      await updateDoc(docRef,{ expire:newExpire });
    }
  });

  loadKeys();
};

window.deleteKey = async function(id){
  await deleteDoc(doc(db,"keys",id));
  loadKeys();
};

window.logout = async function(){
  await signOut(auth);
};

</script>

</body>
</html>
