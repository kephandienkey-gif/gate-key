<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ADMIN KEY</title>
<style>
body{
  font-family:sans-serif;
  background:#0f0f0f;
  color:white;
  text-align:center;
}
button{
  padding:10px;
  margin:6px;
  border-radius:10px;
  border:none;
  background:#00ff99;
  font-weight:bold;
  cursor:pointer;
}
#adminPanel{
  display:none;
}
</style>
</head>
<body>

<h2>沐 ADMIN LOGIN</h2>
<button onclick="login()">ﾄ斉ハg nh蘯ｭp Google</button>
<button onclick="logout()">ﾄ斉ハg xu蘯･t</button>

<div id="adminPanel">
  <h2>沐 ADMIN PANEL</h2>
  <button onclick="createTestKey()">T蘯｡o test key</button>
  <button onclick="deleteAll()">Xﾃｳa t蘯･t c蘯｣</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = { 
  apiKey: "AIzaSyCBoDV8N9q56YjrNlKoiQk6c6fYDNJL2pw",
  authDomain: "kephandienkey-fbee7.firebaseapp.com",
  projectId: "kephandienkey-fbee7",
  storageBucket: "kephandienkey-fbee7.firebasestorage.app",
  messagingSenderId: "1004820527441",
  appId: "1:1004820527441:web:a2ffa3aefb82b99a97fb70"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

const ADMIN_EMAILS = [
  "admin1@gmail.com",
  "admin2@gmail.com"
];

window.login = async function(){
  try{
    await signInWithPopup(auth, provider);
  }catch(e){
    alert("L盻擁 ﾄ惰ハg nh蘯ｭp");
  }
}

window.logout = async function(){
  await signOut(auth);
  location.reload();
}

onAuthStateChanged(auth, (user)=>{
  if(user){

    if(!ADMIN_EMAILS.includes(user.email)){
      alert("Khﾃｴng cﾃｳ quy盻］ truy c蘯ｭp!");
      logout();
      return;
    }

    document.getElementById("adminPanel").style.display="block";
  }
});

window.createTestKey = async function(){
  await addDoc(collection(db,"keys"),{
    key:"TEST-"+Math.floor(Math.random()*99999),
    expire:new Date(Date.now()+3600000),
    limit:1,
    get:0
  });
  alert("ﾄ静｣ t蘯｡o test key");
}

window.deleteAll = async function(){
  const snapshot=await getDocs(collection(db,"keys"));
  for(const docSnap of snapshot.docs){
    await deleteDoc(doc(db,"keys",docSnap.id));
  }
  alert("ﾄ静｣ xﾃｳa");
}

</script>
</body>
</html>
